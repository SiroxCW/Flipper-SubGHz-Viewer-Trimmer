<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flipper SubGhz RSSI Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Left Panel -->
        <div class="left-panel">
            <div class="title">
                Flipper SubGhz RSSI Analyzer
            </div>

            <!-- File Operations -->
            <div class="group">
                <h3>File Operations</h3>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept=".sub,.txt" style="display: none;">
                    <button onclick="document.getElementById('fileInput').click()" class="btn">
                        üìÅ Load SubGhz File
                    </button>
                </div>
                <button onclick="exportData()" class="btn" id="exportBtn" disabled>
                    üíæ Export Data
                </button>
            </div>

            <!-- Signal Information -->
            <div class="group">
                <h3>Signal Information</h3>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">File:</span>
                        <span class="info-value" id="infoFile">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Frequency:</span>
                        <span class="info-value" id="infoFrequency">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Preset:</span>
                        <span class="info-value" id="infoPreset">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Protocol:</span>
                        <span class="info-value" id="infoProtocol">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Data Points:</span>
                        <span class="info-value" id="infoDataPoints">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Duration:</span>
                        <span class="info-value" id="infoDuration">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">RSSI Range:</span>
                        <span class="info-value" id="infoRSSIRange">N/A</span>
                    </div>
                </div>
            </div>

            <!-- Display Controls -->
            <div class="group">
                <h3>Display Controls</h3>
                <p class="info-note">Note: Timing is based on embedded microsecond values</p>
                <p class="info-note">üí° Scroll to zoom, drag to select trim range</p>

                <!-- Data Points Limit Control -->
                <div class="input-group">
                    <label for="dataPointsLimit">Max Points:</label>
                    <select id="dataPointsLimit" onchange="updatePlot()">
                        <option value="1000">1,000</option>
                        <option value="5000" selected>5,000</option>
                        <option value="10000">10,000</option>
                        <option value="25000">25,000</option>
                        <option value="ALL">ALL (No Limit)</option>
                    </select>
                </div>

                <label class="checkbox-container">
                    <input type="checkbox" id="showPositive" checked onchange="updatePlot()">
                    <span class="checkmark"></span>
                    Show Positive Values
                </label>
                <label class="checkbox-container">
                    <input type="checkbox" id="showNegative" checked onchange="updatePlot()">
                    <span class="checkmark"></span>
                    Show Negative Values
                </label>
                <label class="checkbox-container">
                    <input type="checkbox" id="autoScale" checked onchange="updatePlot()">
                    <span class="checkmark"></span>
                    Auto-scale RSSI
                </label>
            </div>

            <!-- Trim Controls -->
            <div class="group">
                <h3>Trim Controls</h3>
                <div class="input-group">
                    <label for="trimStart">Start (s):</label>
                    <input type="number" id="trimStart" value="0" step="0.001" min="0">
                </div>
                <div class="input-group">
                    <label for="trimEnd">End (s):</label>
                    <input type="number" id="trimEnd" value="0" step="0.001" min="0">
                </div>
                <button onclick="applyTrim()" class="btn" id="trimBtn" disabled>
                    ‚úÇÔ∏è Apply Trim
                </button>
                <button onclick="resetData()" class="btn" id="resetBtn" disabled>
                    üîÑ Reset Data
                </button>
            </div>

            <!-- View Controls -->
            <div class="group">
                <h3>View Controls</h3>
                <button onclick="zoomFit()" class="btn" id="zoomBtn" disabled>
                    üîç Zoom to Fit
                </button>
                <button onclick="showStatistics()" class="btn" id="statsBtn" disabled>
                    üìä Show Statistics
                </button>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="group chart-container">
                <h3>RSSI Signal Analysis</h3>
                <div class="chart-wrapper">
                    <canvas id="chart"></canvas>
                </div>
                <div id="statusBar">Ready - Load a .sub file to begin</div>
            </div>
        </div>
    </div>

    <!-- Modal for statistics -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>RSSI Signal Statistics</h2>
            <pre id="statsContent"></pre>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
